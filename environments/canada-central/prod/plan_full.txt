
Terraform used the selected providers to generate the following execution
plan. Resource actions are indicated with the following symbols:
  + create

Terraform will perform the following actions:

  # azurerm_resource_group.main will be created
  + resource "azurerm_resource_group" "main" {
      + id       = (known after apply)
      + location = "canadacentral"
      + name     = "rg-erp-cc-prod"
      + tags     = (known after apply)
    }

  # module.agent_vm.azurerm_linux_virtual_machine.this will be created
  + resource "azurerm_linux_virtual_machine" "this" {
      + admin_password                                         = (sensitive value)
      + admin_username                                         = "azureuser"
      + allow_extension_operations                             = (known after apply)
      + bypass_platform_safety_checks_on_user_schedule_enabled = false
      + computer_name                                          = (known after apply)
      + disable_password_authentication                        = false
      + disk_controller_type                                   = (known after apply)
      + extensions_time_budget                                 = "PT1H30M"
      + id                                                     = (known after apply)
      + location                                               = "canadacentral"
      + max_bid_price                                          = -1
      + name                                                   = "vm-agent-erp-cc-prod"
      + network_interface_ids                                  = (known after apply)
      + os_managed_disk_id                                     = (known after apply)
      + patch_assessment_mode                                  = (known after apply)
      + patch_mode                                             = (known after apply)
      + platform_fault_domain                                  = -1
      + priority                                               = "Regular"
      + private_ip_address                                     = (known after apply)
      + private_ip_addresses                                   = (known after apply)
      + provision_vm_agent                                     = (known after apply)
      + public_ip_address                                      = (known after apply)
      + public_ip_addresses                                    = (known after apply)
      + resource_group_name                                    = "rg-erp-cc-prod"
      + size                                                   = "Standard_B2s"
      + tags                                                   = (known after apply)
      + virtual_machine_id                                     = (known after apply)
      + vm_agent_platform_updates_enabled                      = (known after apply)

      + boot_diagnostics {}

      + identity {
          + principal_id = (known after apply)
          + tenant_id    = (known after apply)
          + type         = "SystemAssigned"
        }

      + os_disk {
          + caching                   = "ReadWrite"
          + disk_size_gb              = 30
          + id                        = (known after apply)
          + name                      = "disk-agent-erp-cc-prod"
          + storage_account_type      = "Premium_LRS"
          + write_accelerator_enabled = false
        }

      + source_image_reference {
          + offer     = "ubuntu-24_04-lts"
          + publisher = "Canonical"
          + sku       = "server"
          + version   = "latest"
        }

      + termination_notification (known after apply)
    }

  # module.agent_vm.azurerm_network_interface.this will be created
  + resource "azurerm_network_interface" "this" {
      + accelerated_networking_enabled = false
      + applied_dns_servers            = (known after apply)
      + id                             = (known after apply)
      + internal_domain_name_suffix    = (known after apply)
      + ip_forwarding_enabled          = false
      + location                       = "canadacentral"
      + mac_address                    = (known after apply)
      + name                           = "nic-agent-erp-cc-prod"
      + private_ip_address             = (known after apply)
      + private_ip_addresses           = (known after apply)
      + resource_group_name            = "rg-erp-cc-prod"
      + tags                           = (known after apply)
      + virtual_machine_id             = (known after apply)

      + ip_configuration {
          + gateway_load_balancer_frontend_ip_configuration_id = (known after apply)
          + name                                               = "ipconfig1"
          + primary                                            = (known after apply)
          + private_ip_address                                 = (known after apply)
          + private_ip_address_allocation                      = "Dynamic"
          + private_ip_address_version                         = "IPv4"
          + subnet_id                                          = (known after apply)
        }
    }

  # module.agent_vm.azurerm_virtual_machine_extension.aad_login[0] will be created
  + resource "azurerm_virtual_machine_extension" "aad_login" {
      + failure_suppression_enabled = false
      + id                          = (known after apply)
      + name                        = "AADSSHLoginForLinux"
      + publisher                   = "Microsoft.Azure.ActiveDirectory"
      + tags                        = (known after apply)
      + type                        = "AADSSHLoginForLinux"
      + type_handler_version        = "1.0"
      + virtual_machine_id          = (known after apply)
    }

  # module.agent_vm.azurerm_virtual_machine_extension.dependency_agent[0] will be created
  + resource "azurerm_virtual_machine_extension" "dependency_agent" {
      + auto_upgrade_minor_version  = true
      + failure_suppression_enabled = false
      + id                          = (known after apply)
      + name                        = "DependencyAgentLinux"
      + publisher                   = "Microsoft.Azure.Monitoring.DependencyAgent"
      + tags                        = (known after apply)
      + type                        = "DependencyAgentLinux"
      + type_handler_version        = "9.10"
      + virtual_machine_id          = (known after apply)
    }

  # module.agent_vm.azurerm_virtual_machine_extension.monitor[0] will be created
  + resource "azurerm_virtual_machine_extension" "monitor" {
      + auto_upgrade_minor_version  = true
      + failure_suppression_enabled = false
      + id                          = (known after apply)
      + name                        = "AzureMonitorLinuxAgent"
      + publisher                   = "Microsoft.Azure.Monitor"
      + tags                        = (known after apply)
      + type                        = "AzureMonitorLinuxAgent"
      + type_handler_version        = "1.29"
      + virtual_machine_id          = (known after apply)
    }

  # module.aks_cluster.azurerm_kubernetes_cluster.this will be created
  + resource "azurerm_kubernetes_cluster" "this" {
      + ai_toolchain_operator_enabled       = false
      + current_kubernetes_version          = (known after apply)
      + dns_prefix                          = "aks-canadacentral-prod-dns"
      + fqdn                                = (known after apply)
      + http_application_routing_zone_name  = (known after apply)
      + id                                  = (known after apply)
      + kube_admin_config                   = (sensitive value)
      + kube_admin_config_raw               = (sensitive value)
      + kube_config                         = (sensitive value)
      + kube_config_raw                     = (sensitive value)
      + kubernetes_version                  = "1.33"
      + location                            = "canadacentral"
      + name                                = "aks-canadacentral-prod"
      + node_os_upgrade_channel             = "NodeImage"
      + node_resource_group                 = "rg-aks-canadacentral-prod-nodes"
      + node_resource_group_id              = (known after apply)
      + oidc_issuer_url                     = (known after apply)
      + portal_fqdn                         = (known after apply)
      + private_cluster_enabled             = true
      + private_cluster_public_fqdn_enabled = false
      + private_dns_zone_id                 = "System"
      + private_fqdn                        = (known after apply)
      + resource_group_name                 = "rg-erp-cc-prod"
      + role_based_access_control_enabled   = true
      + run_command_enabled                 = true
      + sku_tier                            = "Free"
      + support_plan                        = "KubernetesOfficial"
      + tags                                = (known after apply)
      + workload_identity_enabled           = false

      + auto_scaler_profile {
          + balance_similar_node_groups                   = true
          + daemonset_eviction_for_empty_nodes_enabled    = false
          + daemonset_eviction_for_occupied_nodes_enabled = true
          + empty_bulk_delete_max                         = (known after apply)
          + expander                                      = "random"
          + ignore_daemonsets_utilization_enabled         = false
          + max_graceful_termination_sec                  = "600"
          + max_node_provisioning_time                    = "15m"
          + max_unready_nodes                             = 3
          + max_unready_percentage                        = 45
          + new_pod_scale_up_delay                        = (known after apply)
          + scale_down_delay_after_add                    = "10m"
          + scale_down_delay_after_delete                 = "10s"
          + scale_down_delay_after_failure                = "3m"
          + scale_down_unneeded                           = "10m"
          + scale_down_unready                            = "20m"
          + scale_down_utilization_threshold              = "0.5"
          + scan_interval                                 = (known after apply)
          + skip_nodes_with_system_pods                   = true
        }

      + azure_active_directory_role_based_access_control {
          + admin_group_object_ids = [
              + "8711b4ad-7b9c-4f4f-9972-841191901995",
            ]
          + azure_rbac_enabled     = true
          + tenant_id              = "8c440439-38da-4b76-9de0-002f47f4e860"
        }

      + bootstrap_profile (known after apply)

      + default_node_pool {
          + kubelet_disk_type    = (known after apply)
          + max_count            = 5
          + max_pods             = 30
          + min_count            = 1
          + name                 = "system"
          + node_count           = (known after apply)
          + node_labels          = (known after apply)
          + orchestrator_version = (known after apply)
          + os_disk_size_gb      = 128
          + os_disk_type         = "Managed"
          + os_sku               = (known after apply)
          + scale_down_mode      = "Delete"
          + tags                 = (known after apply)
          + type                 = "VirtualMachineScaleSets"
          + ultra_ssd_enabled    = false
          + vm_size              = "Standard_D4s_v5"
          + vnet_subnet_id       = (known after apply)
          + workload_runtime     = (known after apply)
          + zones                = [
              + "1",
              + "2",
              + "3",
            ]

          + upgrade_settings {
              + max_surge = "33%"
            }
        }

      + identity {
          + identity_ids = (known after apply)
          + principal_id = (known after apply)
          + tenant_id    = (known after apply)
          + type         = "UserAssigned"
        }

      + key_vault_secrets_provider {
          + secret_identity          = (known after apply)
          + secret_rotation_enabled  = true
          + secret_rotation_interval = "2m"
        }

      + kubelet_identity (known after apply)

      + network_profile {
          + dns_service_ip      = "10.100.0.10"
          + ip_versions         = (known after apply)
          + load_balancer_sku   = "standard"
          + network_data_plane  = "azure"
          + network_mode        = (known after apply)
          + network_plugin      = "azure"
          + network_plugin_mode = "overlay"
          + network_policy      = "calico"
          + outbound_type       = "loadBalancer"
          + pod_cidr            = "10.244.0.0/16"
          + pod_cidrs           = (known after apply)
          + service_cidr        = "10.100.0.0/16"
          + service_cidrs       = (known after apply)

          + load_balancer_profile (known after apply)

          + nat_gateway_profile (known after apply)
        }

      + oms_agent {
          + log_analytics_workspace_id = (known after apply)
          + oms_agent_identity         = (known after apply)
        }

      + service_mesh_profile {
          + mode      = "Istio"
          + revisions = [
              + "default",
            ]
        }

      + windows_profile (known after apply)
    }

  # module.aks_cluster.azurerm_kubernetes_cluster_node_pool.user[0] will be created
  + resource "azurerm_kubernetes_cluster_node_pool" "user" {
      + id                    = (known after apply)
      + kubelet_disk_type     = (known after apply)
      + kubernetes_cluster_id = (known after apply)
      + max_count             = 5
      + max_pods              = 110
      + min_count             = 1
      + mode                  = "User"
      + name                  = "user"
      + node_count            = (known after apply)
      + node_labels           = {
          + "environment"   = "prod"
          + "nodepool-type" = "user"
          + "subnet-shared" = "true"
          + "workload"      = "application"
        }
      + node_taints           = []
      + orchestrator_version  = (known after apply)
      + os_disk_size_gb       = 128
      + os_disk_type          = "Managed"
      + os_sku                = (known after apply)
      + os_type               = "Linux"
      + priority              = "Regular"
      + scale_down_mode       = "Delete"
      + spot_max_price        = -1
      + tags                  = (known after apply)
      + ultra_ssd_enabled     = false
      + vm_size               = "Standard_F16s_v2"
      + vnet_subnet_id        = (known after apply)
      + zones                 = [
          + "1",
          + "2",
          + "3",
        ]

      + upgrade_settings {
          + max_surge = "33%"
        }
    }

  # module.aks_cluster.azurerm_role_assignment.aks_acr_pull will be created
  + resource "azurerm_role_assignment" "aks_acr_pull" {
      + condition_version                = (known after apply)
      + id                               = (known after apply)
      + name                             = (known after apply)
      + principal_id                     = (known after apply)
      + principal_type                   = (known after apply)
      + role_definition_id               = (known after apply)
      + role_definition_name             = "AcrPull"
      + scope                            = (known after apply)
      + skip_service_principal_aad_check = (known after apply)
    }

  # module.aks_cluster.azurerm_role_assignment.aks_key_vault_secrets_user will be created
  + resource "azurerm_role_assignment" "aks_key_vault_secrets_user" {
      + condition_version                = (known after apply)
      + id                               = (known after apply)
      + name                             = (known after apply)
      + principal_id                     = (known after apply)
      + principal_type                   = (known after apply)
      + role_definition_id               = (known after apply)
      + role_definition_name             = "Key Vault Secrets User"
      + scope                            = (known after apply)
      + skip_service_principal_aad_check = (known after apply)
    }

  # module.aks_cluster.azurerm_role_assignment.aks_monitoring_metrics_publisher will be created
  + resource "azurerm_role_assignment" "aks_monitoring_metrics_publisher" {
      + condition_version                = (known after apply)
      + id                               = (known after apply)
      + name                             = (known after apply)
      + principal_id                     = (known after apply)
      + principal_type                   = (known after apply)
      + role_definition_id               = (known after apply)
      + role_definition_name             = "Monitoring Metrics Publisher"
      + scope                            = (known after apply)
      + skip_service_principal_aad_check = (known after apply)
    }

  # module.aks_cluster.azurerm_role_assignment.aks_network_contributor will be created
  + resource "azurerm_role_assignment" "aks_network_contributor" {
      + condition_version                = (known after apply)
      + id                               = (known after apply)
      + name                             = (known after apply)
      + principal_id                     = (known after apply)
      + principal_type                   = (known after apply)
      + role_definition_id               = (known after apply)
      + role_definition_name             = "Network Contributor"
      + scope                            = (known after apply)
      + skip_service_principal_aad_check = (known after apply)
    }

  # module.aks_cluster.azurerm_user_assigned_identity.aks will be created
  + resource "azurerm_user_assigned_identity" "aks" {
      + client_id           = (known after apply)
      + id                  = (known after apply)
      + location            = "canadacentral"
      + name                = "id-aks-canadacentral-prod"
      + principal_id        = (known after apply)
      + resource_group_name = "rg-erp-cc-prod"
      + tags                = (known after apply)
      + tenant_id           = (known after apply)
    }

  # module.azure_bastion.azurerm_bastion_host.this will be created
  + resource "azurerm_bastion_host" "this" {
      + copy_paste_enabled        = true
      + dns_name                  = (known after apply)
      + file_copy_enabled         = true
      + id                        = (known after apply)
      + ip_connect_enabled        = true
      + kerberos_enabled          = false
      + location                  = "canadacentral"
      + name                      = "bastion-canadacentral-prod"
      + resource_group_name       = "rg-erp-cc-prod"
      + scale_units               = 2
      + session_recording_enabled = false
      + shareable_link_enabled    = false
      + sku                       = "Standard"
      + tags                      = (known after apply)
      + tunneling_enabled         = true

      + ip_configuration {
          + name                 = "bastion-ipconfig"
          + public_ip_address_id = (known after apply)
          + subnet_id            = (known after apply)
        }
    }

  # module.azure_bastion.azurerm_monitor_diagnostic_setting.bastion will be created
  + resource "azurerm_monitor_diagnostic_setting" "bastion" {
      + id                             = (known after apply)
      + log_analytics_destination_type = (known after apply)
      + log_analytics_workspace_id     = (known after apply)
      + name                           = "diag-bastion-canadacentral-prod"
      + target_resource_id             = (known after apply)

      + enabled_log {
          + category       = "BastionAuditLogs"
            # (1 unchanged attribute hidden)
        }

      + enabled_metric {
          + category = "AllMetrics"
        }

      + metric (known after apply)
    }

  # module.azure_bastion.azurerm_public_ip.bastion will be created
  + resource "azurerm_public_ip" "bastion" {
      + allocation_method       = "Static"
      + ddos_protection_mode    = "VirtualNetworkInherited"
      + fqdn                    = (known after apply)
      + id                      = (known after apply)
      + idle_timeout_in_minutes = 4
      + ip_address              = (known after apply)
      + ip_version              = "IPv4"
      + location                = "canadacentral"
      + name                    = "pip-bastion-canadacentral-prod"
      + resource_group_name     = "rg-erp-cc-prod"
      + sku                     = "Standard"
      + sku_tier                = "Regional"
      + tags                    = (known after apply)
      + zones                   = [
          + "1",
          + "2",
          + "3",
        ]
    }

  # module.azure_firewall.azurerm_firewall.this will be created
  + resource "azurerm_firewall" "this" {
      + dns_proxy_enabled   = (known after apply)
      + firewall_policy_id  = (known after apply)
      + id                  = (known after apply)
      + location            = "canadacentral"
      + name                = "azfw-canadacentral-prod"
      + resource_group_name = "rg-erp-cc-prod"
      + sku_name            = "AZFW_VNet"
      + sku_tier            = "Premium"
      + tags                = (known after apply)
      + threat_intel_mode   = (known after apply)
      + zones               = [
          + "1",
          + "2",
          + "3",
        ]

      + ip_configuration {
          + name                 = "fw-ipconfig"
          + private_ip_address   = (known after apply)
          + public_ip_address_id = (known after apply)
          + subnet_id            = (known after apply)
        }

      + management_ip_configuration {
          + name                 = "fw-mgmt-ipconfig"
          + private_ip_address   = (known after apply)
          + public_ip_address_id = (known after apply)
          + subnet_id            = (known after apply)
        }
    }

  # module.azure_firewall.azurerm_firewall_policy.this will be created
  + resource "azurerm_firewall_policy" "this" {
      + child_policies           = (known after apply)
      + firewalls                = (known after apply)
      + id                       = (known after apply)
      + location                 = "canadacentral"
      + name                     = "azfwpol-canadacentral-prod"
      + resource_group_name      = "rg-erp-cc-prod"
      + rule_collection_groups   = (known after apply)
      + sku                      = "Premium"
      + tags                     = (known after apply)
      + threat_intelligence_mode = "Deny"

      + dns {
          + proxy_enabled = true
          + servers       = []
        }

      + intrusion_detection {
          + mode = "Deny"
        }
    }

  # module.azure_firewall.azurerm_firewall_policy_rule_collection_group.application will be created
  + resource "azurerm_firewall_policy_rule_collection_group" "application" {
      + firewall_policy_id = (known after apply)
      + id                 = (known after apply)
      + name               = "application-rules"
      + priority           = 300

      + application_rule_collection {
          + action   = "Allow"
          + name     = "allow-azure-fqdns"
          + priority = 100

          + rule {
              + destination_fqdns = [
                  + "management.azure.com",
                  + "*.management.azure.com",
                  + "login.microsoftonline.com",
                  + "*.login.microsoftonline.com",
                  + "graph.windows.net",
                ]
              + name              = "allow-azure-management"
              + source_addresses  = [
                  + "*",
                ]

              + protocols {
                  + port = 443
                  + type = "Https"
                }
            }
          + rule {
              + destination_fqdns = [
                  + "*.azurecr.io",
                  + "*.blob.core.windows.net",
                  + "mcr.microsoft.com",
                  + "*.data.mcr.microsoft.com",
                ]
              + name              = "allow-acr-fqdns"
              + source_addresses  = [
                  + "*",
                ]

              + protocols {
                  + port = 443
                  + type = "Https"
                }
            }
          + rule {
              + destination_fqdns = [
                  + "*.vault.azure.net",
                  + "*.vaultcore.azure.net",
                ]
              + name              = "allow-keyvault-fqdns"
              + source_addresses  = [
                  + "*",
                ]

              + protocols {
                  + port = 443
                  + type = "Https"
                }
            }
          + rule {
              + destination_fqdns = [
                  + "*.ods.opinsights.azure.com",
                  + "*.oms.opinsights.azure.com",
                  + "*.monitoring.azure.com",
                  + "dc.services.visualstudio.com",
                ]
              + name              = "allow-monitoring-fqdns"
              + source_addresses  = [
                  + "*",
                ]

              + protocols {
                  + port = 443
                  + type = "Https"
                }
            }
        }
      + application_rule_collection {
          + action   = "Allow"
          + name     = "allow-aks-fqdns"
          + priority = 110

          + rule {
              + destination_fqdn_tags = [
                  + "AzureKubernetesService",
                ]
              + name                  = "allow-aks-core"
              + source_addresses      = [
                  + "*",
                ]

              + protocols {
                  + port = 443
                  + type = "Https"
                }
            }
          + rule {
              + destination_fqdns = [
                  + "security.ubuntu.com",
                  + "azure.archive.ubuntu.com",
                  + "changelogs.ubuntu.com",
                ]
              + name              = "allow-ubuntu-updates"
              + source_addresses  = [
                  + "*",
                ]

              + protocols {
                  + port = 80
                  + type = "Http"
                }
              + protocols {
                  + port = 443
                  + type = "Https"
                }
            }
          + rule {
              + destination_fqdns = [
                  + "packages.cloud.google.com",
                  + "apt.kubernetes.io",
                ]
              + name              = "allow-k8s-packages"
              + source_addresses  = [
                  + "*",
                ]

              + protocols {
                  + port = 443
                  + type = "Https"
                }
            }
          + rule {
              + destination_fqdns = [
                  + "packages.microsoft.com",
                ]
              + name              = "allow-microsoft-packages"
              + source_addresses  = [
                  + "*",
                ]

              + protocols {
                  + port = 443
                  + type = "Https"
                }
            }
        }
      + application_rule_collection {
          + action   = "Allow"
          + name     = "allow-container-registries"
          + priority = 120

          + rule {
              + destination_fqdns = [
                  + "hub.docker.com",
                  + "registry-1.docker.io",
                  + "*.docker.io",
                  + "production.cloudflare.docker.com",
                ]
              + name              = "allow-dockerhub"
              + source_addresses  = [
                  + "*",
                ]

              + protocols {
                  + port = 443
                  + type = "Https"
                }
            }
          + rule {
              + destination_fqdns = [
                  + "ghcr.io",
                  + "*.ghcr.io",
                ]
              + name              = "allow-ghcr"
              + source_addresses  = [
                  + "*",
                ]

              + protocols {
                  + port = 443
                  + type = "Https"
                }
            }
          + rule {
              + destination_fqdns = [
                  + "quay.io",
                  + "*.quay.io",
                ]
              + name              = "allow-quay"
              + source_addresses  = [
                  + "*",
                ]

              + protocols {
                  + port = 443
                  + type = "Https"
                }
            }
        }
      + application_rule_collection {
          + action   = "Allow"
          + name     = "allow-custom-fqdns"
          + priority = 130

          + rule {
              + destination_fqdns = []
              + name              = "allow-custom-domains"
              + source_addresses  = [
                  + "*",
                ]

              + protocols {
                  + port = 443
                  + type = "Https"
                }
              + protocols {
                  + port = 80
                  + type = "Http"
                }
            }
        }
    }

  # module.azure_firewall.azurerm_firewall_policy_rule_collection_group.dnat will be created
  + resource "azurerm_firewall_policy_rule_collection_group" "dnat" {
      + firewall_policy_id = (known after apply)
      + id                 = (known after apply)
      + name               = "dnat-rules"
      + priority           = 100

      + nat_rule_collection {
          + action   = "Dnat"
          + name     = "cloudflare-to-istio-ilb"
          + priority = 100

          + rule {
              + destination_address = (known after apply)
              + destination_ports   = [
                  + "80",
                ]
              + name                = "allow-http-from-cloudflare"
              + protocols           = [
                  + "TCP",
                ]
              + source_addresses    = [
                  + "173.245.48.0/20",
                  + "103.21.244.0/22",
                  + "103.22.200.0/22",
                  + "103.31.4.0/22",
                  + "141.101.64.0/18",
                  + "108.162.192.0/18",
                  + "190.93.240.0/20",
                  + "188.114.96.0/20",
                  + "197.234.240.0/22",
                  + "198.41.128.0/17",
                  + "162.158.0.0/15",
                  + "104.16.0.0/13",
                  + "104.24.0.0/14",
                  + "172.64.0.0/13",
                  + "131.0.72.0/22",
                ]
              + translated_port     = 80
                # (1 unchanged attribute hidden)
            }
          + rule {
              + destination_address = (known after apply)
              + destination_ports   = [
                  + "443",
                ]
              + name                = "allow-https-from-cloudflare"
              + protocols           = [
                  + "TCP",
                ]
              + source_addresses    = [
                  + "173.245.48.0/20",
                  + "103.21.244.0/22",
                  + "103.22.200.0/22",
                  + "103.31.4.0/22",
                  + "141.101.64.0/18",
                  + "108.162.192.0/18",
                  + "190.93.240.0/20",
                  + "188.114.96.0/20",
                  + "197.234.240.0/22",
                  + "198.41.128.0/17",
                  + "162.158.0.0/15",
                  + "104.16.0.0/13",
                  + "104.24.0.0/14",
                  + "172.64.0.0/13",
                  + "131.0.72.0/22",
                ]
              + translated_port     = 443
                # (1 unchanged attribute hidden)
            }
        }
    }

  # module.azure_firewall.azurerm_firewall_policy_rule_collection_group.network will be created
  + resource "azurerm_firewall_policy_rule_collection_group" "network" {
      + firewall_policy_id = (known after apply)
      + id                 = (known after apply)
      + name               = "network-rules"
      + priority           = 200

      + network_rule_collection {
          + action   = "Allow"
          + name     = "allow-azure-services"
          + priority = 100

          + rule {
              + destination_addresses = [
                  + "AzureMonitor",
                ]
              + destination_ports     = [
                  + "443",
                ]
              + name                  = "allow-azure-monitor"
              + protocols             = [
                  + "TCP",
                ]
              + source_addresses      = [
                  + "*",
                ]
            }
          + rule {
              + destination_addresses = [
                  + "Storage",
                ]
              + destination_ports     = [
                  + "443",
                  + "445",
                ]
              + name                  = "allow-azure-storage"
              + protocols             = [
                  + "TCP",
                  + "UDP",
                ]
              + source_addresses      = [
                  + "*",
                ]
            }
          + rule {
              + destination_addresses = [
                  + "AzureContainerRegistry",
                ]
              + destination_ports     = [
                  + "443",
                ]
              + name                  = "allow-azure-acr"
              + protocols             = [
                  + "TCP",
                ]
              + source_addresses      = [
                  + "*",
                ]
            }
          + rule {
              + destination_addresses = [
                  + "AzureKeyVault",
                ]
              + destination_ports     = [
                  + "443",
                ]
              + name                  = "allow-azure-keyvault"
              + protocols             = [
                  + "TCP",
                ]
              + source_addresses      = [
                  + "*",
                ]
            }
          + rule {
              + destination_addresses = [
                  + "Sql",
                ]
              + destination_ports     = [
                  + "1433",
                  + "5432",
                ]
              + name                  = "allow-azure-database"
              + protocols             = [
                  + "TCP",
                ]
              + source_addresses      = [
                  + "*",
                ]
            }
        }
      + network_rule_collection {
          + action   = "Allow"
          + name     = "allow-aks-required"
          + priority = 110

          + rule {
              + destination_addresses = [
                  + "AzureCloud",
                ]
              + destination_ports     = [
                  + "443",
                  + "9000",
                ]
              + name                  = "allow-aks-apiserver"
              + protocols             = [
                  + "TCP",
                ]
              + source_addresses      = [
                  + "*",
                ]
            }
          + rule {
              + destination_addresses = [
                  + "91.189.89.198",
                  + "91.189.94.4",
                  + "91.189.91.157",
                  + "time.windows.com",
                ]
              + destination_ports     = [
                  + "123",
                ]
              + name                  = "allow-ntp"
              + protocols             = [
                  + "UDP",
                ]
              + source_addresses      = [
                  + "*",
                ]
            }
          + rule {
              + destination_addresses = [
                  + "8.8.8.8",
                  + "8.8.4.4",
                  + "1.1.1.1",
                  + "1.0.0.1",
                ]
              + destination_ports     = [
                  + "53",
                ]
              + name                  = "allow-external-dns"
              + protocols             = [
                  + "UDP",
                  + "TCP",
                ]
              + source_addresses      = [
                  + "*",
                ]
            }
        }
      + network_rule_collection {
          + action   = "Allow"
          + name     = "allow-custom-outbound"
          + priority = 120

          + rule {
              + destination_addresses = []
              + destination_ports     = [
                  + "443",
                ]
              + name                  = "allow-external-apis"
              + protocols             = [
                  + "TCP",
                ]
              + source_addresses      = [
                  + "*",
                ]
            }
        }
      + network_rule_collection {
          + action   = "Allow"
          + name     = "allow-vnet-to-vnet"
          + priority = 130

          + rule {
              + destination_addresses = [
                  + "10.1.0.0/16",
                ]
              + destination_ports     = [
                  + "*",
                ]
              + name                  = "allow-hub-to-spoke"
              + protocols             = [
                  + "Any",
                ]
              + source_addresses      = [
                  + "10.0.0.0/16",
                ]
            }
          + rule {
              + destination_addresses = [
                  + "10.0.0.0/16",
                ]
              + destination_ports     = [
                  + "*",
                ]
              + name                  = "allow-spoke-to-hub"
              + protocols             = [
                  + "Any",
                ]
              + source_addresses      = [
                  + "10.1.0.0/16",
                ]
            }
        }
    }

  # module.azure_firewall.azurerm_monitor_diagnostic_setting.firewall will be created
  + resource "azurerm_monitor_diagnostic_setting" "firewall" {
      + id                             = (known after apply)
      + log_analytics_destination_type = (known after apply)
      + log_analytics_workspace_id     = (known after apply)
      + name                           = "diag-azfw-canadacentral-prod"
      + target_resource_id             = (known after apply)

      + enabled_log {
          + category       = "AZFWApplicationRule"
            # (1 unchanged attribute hidden)
        }
      + enabled_log {
          + category       = "AZFWDnsQuery"
            # (1 unchanged attribute hidden)
        }
      + enabled_log {
          + category       = "AZFWFqdnResolveFailure"
            # (1 unchanged attribute hidden)
        }
      + enabled_log {
          + category       = "AZFWIdpsSignature"
            # (1 unchanged attribute hidden)
        }
      + enabled_log {
          + category       = "AZFWNatRule"
            # (1 unchanged attribute hidden)
        }
      + enabled_log {
          + category       = "AZFWNetworkRule"
            # (1 unchanged attribute hidden)
        }
      + enabled_log {
          + category       = "AZFWThreatIntel"
            # (1 unchanged attribute hidden)
        }
      + enabled_log {
          + category       = "AzureFirewallApplicationRule"
            # (1 unchanged attribute hidden)
        }
      + enabled_log {
          + category       = "AzureFirewallDnsProxy"
            # (1 unchanged attribute hidden)
        }
      + enabled_log {
          + category       = "AzureFirewallNetworkRule"
            # (1 unchanged attribute hidden)
        }

      + enabled_metric {
          + category = "AllMetrics"
        }

      + metric (known after apply)
    }

  # module.azure_firewall.azurerm_public_ip.firewall will be created
  + resource "azurerm_public_ip" "firewall" {
      + allocation_method       = "Static"
      + ddos_protection_mode    = "VirtualNetworkInherited"
      + fqdn                    = (known after apply)
      + id                      = (known after apply)
      + idle_timeout_in_minutes = 4
      + ip_address              = (known after apply)
      + ip_version              = "IPv4"
      + location                = "canadacentral"
      + name                    = "pip-azfw-canadacentral-prod"
      + resource_group_name     = "rg-erp-cc-prod"
      + sku                     = "Standard"
      + sku_tier                = "Regional"
      + tags                    = (known after apply)
      + zones                   = [
          + "1",
          + "2",
          + "3",
        ]
    }

  # module.azure_firewall.azurerm_public_ip.firewall_management will be created
  + resource "azurerm_public_ip" "firewall_management" {
      + allocation_method       = "Static"
      + ddos_protection_mode    = "VirtualNetworkInherited"
      + fqdn                    = (known after apply)
      + id                      = (known after apply)
      + idle_timeout_in_minutes = 4
      + ip_address              = (known after apply)
      + ip_version              = "IPv4"
      + location                = "canadacentral"
      + name                    = "pip-azfw-mgmt-canadacentral-prod"
      + resource_group_name     = "rg-erp-cc-prod"
      + sku                     = "Standard"
      + sku_tier                = "Regional"
      + tags                    = (known after apply)
      + zones                   = [
          + "1",
          + "2",
          + "3",
        ]
    }

  # module.container_registry.azurerm_container_registry.this will be created
  + resource "azurerm_container_registry" "this" {
      + admin_enabled                 = false
      + admin_password                = (sensitive value)
      + admin_username                = (known after apply)
      + data_endpoint_host_names      = (known after apply)
      + encryption                    = (known after apply)
      + export_policy_enabled         = true
      + id                            = (known after apply)
      + location                      = "canadacentral"
      + login_server                  = (known after apply)
      + name                          = "acrerpccprod"
      + network_rule_bypass_option    = "AzureServices"
      + network_rule_set              = (known after apply)
      + public_network_access_enabled = false
      + resource_group_name           = "rg-erp-cc-prod"
      + sku                           = "Premium"
      + tags                          = (known after apply)
      + trust_policy_enabled          = false
      + zone_redundancy_enabled       = false
    }

  # module.container_registry.azurerm_private_endpoint.this[0] will be created
  + resource "azurerm_private_endpoint" "this" {
      + custom_dns_configs       = (known after apply)
      + id                       = (known after apply)
      + location                 = "canadacentral"
      + name                     = "acrerpccprod-pe"
      + network_interface        = (known after apply)
      + private_dns_zone_configs = (known after apply)
      + resource_group_name      = "rg-erp-cc-prod"
      + subnet_id                = (known after apply)
      + tags                     = (known after apply)

      + private_dns_zone_group {
          + id                   = (known after apply)
          + name                 = "acr-dns-zone-group"
          + private_dns_zone_ids = (known after apply)
        }

      + private_service_connection {
          + is_manual_connection           = false
          + name                           = "acrerpccprod-psc"
          + private_connection_resource_id = (known after apply)
          + private_ip_address             = (known after apply)
          + subresource_names              = [
              + "registry",
            ]
        }
    }

  # module.hub_vnet.azurerm_subnet.bastion will be created
  + resource "azurerm_subnet" "bastion" {
      + address_prefixes                              = [
          + "10.0.3.0/27",
        ]
      + default_outbound_access_enabled               = true
      + id                                            = (known after apply)
      + name                                          = "AzureBastionSubnet"
      + private_endpoint_network_policies             = "Disabled"
      + private_link_service_network_policies_enabled = true
      + resource_group_name                           = "rg-erp-cc-prod"
      + virtual_network_name                          = "vnet-hub-canadacentral-prod"
    }

  # module.hub_vnet.azurerm_subnet.firewall will be created
  + resource "azurerm_subnet" "firewall" {
      + address_prefixes                              = [
          + "10.0.1.0/26",
        ]
      + default_outbound_access_enabled               = true
      + id                                            = (known after apply)
      + name                                          = "AzureFirewallSubnet"
      + private_endpoint_network_policies             = "Disabled"
      + private_link_service_network_policies_enabled = true
      + resource_group_name                           = "rg-erp-cc-prod"
      + virtual_network_name                          = "vnet-hub-canadacentral-prod"
    }

  # module.hub_vnet.azurerm_subnet.firewall_management will be created
  + resource "azurerm_subnet" "firewall_management" {
      + address_prefixes                              = [
          + "10.0.2.0/26",
        ]
      + default_outbound_access_enabled               = true
      + id                                            = (known after apply)
      + name                                          = "AzureFirewallManagementSubnet"
      + private_endpoint_network_policies             = "Disabled"
      + private_link_service_network_policies_enabled = true
      + resource_group_name                           = "rg-erp-cc-prod"
      + virtual_network_name                          = "vnet-hub-canadacentral-prod"
    }

  # module.hub_vnet.azurerm_subnet.private_endpoints will be created
  + resource "azurerm_subnet" "private_endpoints" {
      + address_prefixes                              = [
          + "10.0.5.0/24",
        ]
      + default_outbound_access_enabled               = true
      + id                                            = (known after apply)
      + name                                          = "PrivateEndpointsSubnet"
      + private_endpoint_network_policies             = "Disabled"
      + private_link_service_network_policies_enabled = true
      + resource_group_name                           = "rg-erp-cc-prod"
      + virtual_network_name                          = "vnet-hub-canadacentral-prod"
    }

  # module.hub_vnet.azurerm_subnet.shared_services will be created
  + resource "azurerm_subnet" "shared_services" {
      + address_prefixes                              = [
          + "10.0.4.0/24",
        ]
      + default_outbound_access_enabled               = true
      + id                                            = (known after apply)
      + name                                          = "SharedServicesSubnet"
      + private_endpoint_network_policies             = "Disabled"
      + private_link_service_network_policies_enabled = true
      + resource_group_name                           = "rg-erp-cc-prod"
      + virtual_network_name                          = "vnet-hub-canadacentral-prod"
    }

  # module.hub_vnet.azurerm_virtual_network.hub will be created
  + resource "azurerm_virtual_network" "hub" {
      + address_space                  = [
          + "10.0.0.0/16",
        ]
      + dns_servers                    = (known after apply)
      + guid                           = (known after apply)
      + id                             = (known after apply)
      + location                       = "canadacentral"
      + name                           = "vnet-hub-canadacentral-prod"
      + private_endpoint_vnet_policies = "Disabled"
      + resource_group_name            = "rg-erp-cc-prod"
      + subnet                         = (known after apply)
      + tags                           = (known after apply)
    }

  # module.jumpbox.azurerm_linux_virtual_machine.this will be created
  + resource "azurerm_linux_virtual_machine" "this" {
      + admin_password                                         = (sensitive value)
      + admin_username                                         = "azureuser"
      + allow_extension_operations                             = (known after apply)
      + bypass_platform_safety_checks_on_user_schedule_enabled = false
      + computer_name                                          = (known after apply)
      + disable_password_authentication                        = false
      + disk_controller_type                                   = (known after apply)
      + extensions_time_budget                                 = "PT1H30M"
      + id                                                     = (known after apply)
      + location                                               = "canadacentral"
      + max_bid_price                                          = -1
      + name                                                   = "vm-jumpbox-erp-cc-prod"
      + network_interface_ids                                  = (known after apply)
      + os_managed_disk_id                                     = (known after apply)
      + patch_assessment_mode                                  = (known after apply)
      + patch_mode                                             = (known after apply)
      + platform_fault_domain                                  = -1
      + priority                                               = "Regular"
      + private_ip_address                                     = (known after apply)
      + private_ip_addresses                                   = (known after apply)
      + provision_vm_agent                                     = (known after apply)
      + public_ip_address                                      = (known after apply)
      + public_ip_addresses                                    = (known after apply)
      + resource_group_name                                    = "rg-erp-cc-prod"
      + size                                                   = "Standard_B2s"
      + tags                                                   = (known after apply)
      + virtual_machine_id                                     = (known after apply)
      + vm_agent_platform_updates_enabled                      = (known after apply)

      + boot_diagnostics {}

      + identity {
          + principal_id = (known after apply)
          + tenant_id    = (known after apply)
          + type         = "SystemAssigned"
        }

      + os_disk {
          + caching                   = "ReadWrite"
          + disk_size_gb              = 30
          + id                        = (known after apply)
          + name                      = "disk-jumpbox-erp-cc-prod"
          + storage_account_type      = "Premium_LRS"
          + write_accelerator_enabled = false
        }

      + source_image_reference {
          + offer     = "ubuntu-24_04-lts"
          + publisher = "Canonical"
          + sku       = "server"
          + version   = "latest"
        }

      + termination_notification (known after apply)
    }

  # module.jumpbox.azurerm_network_interface.this will be created
  + resource "azurerm_network_interface" "this" {
      + accelerated_networking_enabled = false
      + applied_dns_servers            = (known after apply)
      + id                             = (known after apply)
      + internal_domain_name_suffix    = (known after apply)
      + ip_forwarding_enabled          = false
      + location                       = "canadacentral"
      + mac_address                    = (known after apply)
      + name                           = "nic-jumpbox-erp-cc-prod"
      + private_ip_address             = (known after apply)
      + private_ip_addresses           = (known after apply)
      + resource_group_name            = "rg-erp-cc-prod"
      + tags                           = (known after apply)
      + virtual_machine_id             = (known after apply)

      + ip_configuration {
          + gateway_load_balancer_frontend_ip_configuration_id = (known after apply)
          + name                                               = "ipconfig1"
          + primary                                            = (known after apply)
          + private_ip_address                                 = (known after apply)
          + private_ip_address_allocation                      = "Dynamic"
          + private_ip_address_version                         = "IPv4"
          + subnet_id                                          = (known after apply)
        }
    }

  # module.jumpbox.azurerm_virtual_machine_extension.aad_login[0] will be created
  + resource "azurerm_virtual_machine_extension" "aad_login" {
      + failure_suppression_enabled = false
      + id                          = (known after apply)
      + name                        = "AADSSHLoginForLinux"
      + publisher                   = "Microsoft.Azure.ActiveDirectory"
      + tags                        = (known after apply)
      + type                        = "AADSSHLoginForLinux"
      + type_handler_version        = "1.0"
      + virtual_machine_id          = (known after apply)
    }

  # module.jumpbox.azurerm_virtual_machine_extension.dependency_agent[0] will be created
  + resource "azurerm_virtual_machine_extension" "dependency_agent" {
      + auto_upgrade_minor_version  = true
      + failure_suppression_enabled = false
      + id                          = (known after apply)
      + name                        = "DependencyAgentLinux"
      + publisher                   = "Microsoft.Azure.Monitoring.DependencyAgent"
      + tags                        = (known after apply)
      + type                        = "DependencyAgentLinux"
      + type_handler_version        = "9.10"
      + virtual_machine_id          = (known after apply)
    }

  # module.jumpbox.azurerm_virtual_machine_extension.monitor[0] will be created
  + resource "azurerm_virtual_machine_extension" "monitor" {
      + auto_upgrade_minor_version  = true
      + failure_suppression_enabled = false
      + id                          = (known after apply)
      + name                        = "AzureMonitorLinuxAgent"
      + publisher                   = "Microsoft.Azure.Monitor"
      + tags                        = (known after apply)
      + type                        = "AzureMonitorLinuxAgent"
      + type_handler_version        = "1.29"
      + virtual_machine_id          = (known after apply)
    }

  # module.key_vault.azurerm_key_vault.this will be created
  + resource "azurerm_key_vault" "this" {
      + access_policy                   = (known after apply)
      + enable_rbac_authorization       = (known after apply)
      + enabled_for_deployment          = false
      + enabled_for_disk_encryption     = true
      + enabled_for_template_deployment = false
      + id                              = (known after apply)
      + location                        = "canadacentral"
      + name                            = "kv-erp-cc-prod"
      + public_network_access_enabled   = false
      + purge_protection_enabled        = true
      + rbac_authorization_enabled      = true
      + resource_group_name             = "rg-erp-cc-prod"
      + sku_name                        = "premium"
      + soft_delete_retention_days      = 90
      + tags                            = (known after apply)
      + tenant_id                       = "8c440439-38da-4b76-9de0-002f47f4e860"
      + vault_uri                       = (known after apply)

      + contact (known after apply)

      + network_acls {
          + bypass         = "AzureServices"
          + default_action = "Deny"
        }
    }

  # module.key_vault.azurerm_monitor_diagnostic_setting.key_vault will be created
  + resource "azurerm_monitor_diagnostic_setting" "key_vault" {
      + id                             = (known after apply)
      + log_analytics_destination_type = (known after apply)
      + log_analytics_workspace_id     = (known after apply)
      + name                           = "diag-kv-erp-cc-prod"
      + target_resource_id             = (known after apply)

      + enabled_log {
          + category       = "AuditEvent"
            # (1 unchanged attribute hidden)
        }
      + enabled_log {
          + category       = "AzurePolicyEvaluationDetails"
            # (1 unchanged attribute hidden)
        }

      + enabled_metric {
          + category = "AllMetrics"
        }

      + metric (known after apply)
    }

  # module.key_vault.azurerm_private_endpoint.this[0] will be created
  + resource "azurerm_private_endpoint" "this" {
      + custom_dns_configs       = (known after apply)
      + id                       = (known after apply)
      + location                 = "canadacentral"
      + name                     = "kv-erp-cc-prod-pe"
      + network_interface        = (known after apply)
      + private_dns_zone_configs = (known after apply)
      + resource_group_name      = "rg-erp-cc-prod"
      + subnet_id                = (known after apply)
      + tags                     = (known after apply)

      + private_dns_zone_group {
          + id                   = (known after apply)
          + name                 = "keyvault-dns-zone-group"
          + private_dns_zone_ids = (known after apply)
        }

      + private_service_connection {
          + is_manual_connection           = false
          + name                           = "kv-erp-cc-prod-psc"
          + private_connection_resource_id = (known after apply)
          + private_ip_address             = (known after apply)
          + subresource_names              = [
              + "vault",
            ]
        }
    }

  # module.log_analytics.azurerm_log_analytics_solution.container_insights[0] will be created
  + resource "azurerm_log_analytics_solution" "container_insights" {
      + id                    = (known after apply)
      + location              = "canadacentral"
      + resource_group_name   = "rg-erp-cc-prod"
      + solution_name         = "ContainerInsights"
      + workspace_name        = "log-erp-cc-prod"
      + workspace_resource_id = (known after apply)

      + plan {
          + name      = (known after apply)
          + product   = "OMSGallery/ContainerInsights"
          + publisher = "Microsoft"
        }
    }

  # module.log_analytics.azurerm_log_analytics_workspace.this will be created
  + resource "azurerm_log_analytics_workspace" "this" {
      + allow_resource_only_permissions = true
      + daily_quota_gb                  = -1
      + id                              = (known after apply)
      + internet_ingestion_enabled      = true
      + internet_query_enabled          = true
      + local_authentication_disabled   = (known after apply)
      + local_authentication_enabled    = (known after apply)
      + location                        = "canadacentral"
      + name                            = "log-erp-cc-prod"
      + primary_shared_key              = (sensitive value)
      + resource_group_name             = "rg-erp-cc-prod"
      + retention_in_days               = 30
      + secondary_shared_key            = (sensitive value)
      + sku                             = "PerGB2018"
      + tags                            = (known after apply)
      + workspace_id                    = (known after apply)
    }

  # module.postgresql.azurerm_monitor_diagnostic_setting.postgresql will be created
  + resource "azurerm_monitor_diagnostic_setting" "postgresql" {
      + id                             = (known after apply)
      + log_analytics_destination_type = (known after apply)
      + log_analytics_workspace_id     = (known after apply)
      + name                           = "diag-psql-erp-cc-prod"
      + target_resource_id             = (known after apply)

      + enabled_log {
          + category       = "PostgreSQLLogs"
            # (1 unchanged attribute hidden)
        }

      + enabled_metric {
          + category = "AllMetrics"
        }

      + metric (known after apply)
    }

  # module.postgresql.azurerm_postgresql_flexible_server.this will be created
  + resource "azurerm_postgresql_flexible_server" "this" {
      + administrator_login           = (sensitive value)
      + administrator_password        = (sensitive value)
      + administrator_password_wo     = (write-only attribute)
      + auto_grow_enabled             = false
      + backup_retention_days         = 7
      + delegated_subnet_id           = (known after apply)
      + fqdn                          = (known after apply)
      + geo_redundant_backup_enabled  = true
      + id                            = (known after apply)
      + location                      = "canadacentral"
      + name                          = "psql-erp-cc-prod"
      + private_dns_zone_id           = (known after apply)
      + public_network_access_enabled = false
      + resource_group_name           = "rg-erp-cc-prod"
      + sku_name                      = "GP_Standard_D4s_v3"
      + storage_mb                    = 131072
      + storage_tier                  = "P20"
      + tags                          = (known after apply)
      + version                       = "17"
      + zone                          = "1"

      + authentication (known after apply)

      + high_availability {
          + mode                      = "ZoneRedundant"
          + standby_availability_zone = "2"
        }
    }

  # module.postgresql.azurerm_postgresql_flexible_server_configuration.maintenance_work_mem will be created
  + resource "azurerm_postgresql_flexible_server_configuration" "maintenance_work_mem" {
      + id        = (known after apply)
      + name      = "maintenance_work_mem"
      + server_id = (known after apply)
      + value     = "512"
    }

  # module.postgresql.azurerm_postgresql_flexible_server_configuration.max_connections will be created
  + resource "azurerm_postgresql_flexible_server_configuration" "max_connections" {
      + id        = (known after apply)
      + name      = "max_connections"
      + server_id = (known after apply)
      + value     = "200"
    }

  # module.postgresql.azurerm_postgresql_flexible_server_configuration.shared_buffers will be created
  + resource "azurerm_postgresql_flexible_server_configuration" "shared_buffers" {
      + id        = (known after apply)
      + name      = "shared_buffers"
      + server_id = (known after apply)
      + value     = "4096"
    }

  # module.postgresql.azurerm_postgresql_flexible_server_configuration.work_mem will be created
  + resource "azurerm_postgresql_flexible_server_configuration" "work_mem" {
      + id        = (known after apply)
      + name      = "work_mem"
      + server_id = (known after apply)
      + value     = "64"
    }

  # module.private_dns_zones["acr"].azurerm_private_dns_zone.this will be created
  + resource "azurerm_private_dns_zone" "this" {
      + id                                                    = (known after apply)
      + max_number_of_record_sets                             = (known after apply)
      + max_number_of_virtual_network_links                   = (known after apply)
      + max_number_of_virtual_network_links_with_registration = (known after apply)
      + name                                                  = "privatelink.azurecr.io"
      + number_of_record_sets                                 = (known after apply)
      + resource_group_name                                   = "rg-erp-cc-prod"
      + tags                                                  = (known after apply)

      + soa_record (known after apply)
    }

  # module.private_dns_zones["acr"].azurerm_private_dns_zone_virtual_network_link.spoke_links[0] will be created
  + resource "azurerm_private_dns_zone_virtual_network_link" "spoke_links" {
      + id                    = (known after apply)
      + name                  = (known after apply)
      + private_dns_zone_name = "privatelink.azurecr.io"
      + registration_enabled  = false
      + resolution_policy     = (known after apply)
      + resource_group_name   = "rg-erp-cc-prod"
      + tags                  = (known after apply)
      + virtual_network_id    = (known after apply)
    }

  # module.private_dns_zones["aks"].azurerm_private_dns_zone.this will be created
  + resource "azurerm_private_dns_zone" "this" {
      + id                                                    = (known after apply)
      + max_number_of_record_sets                             = (known after apply)
      + max_number_of_virtual_network_links                   = (known after apply)
      + max_number_of_virtual_network_links_with_registration = (known after apply)
      + name                                                  = "privatelink.canadacentral.azmk8s.io"
      + number_of_record_sets                                 = (known after apply)
      + resource_group_name                                   = "rg-erp-cc-prod"
      + tags                                                  = (known after apply)

      + soa_record (known after apply)
    }

  # module.private_dns_zones["aks"].azurerm_private_dns_zone_virtual_network_link.spoke_links[0] will be created
  + resource "azurerm_private_dns_zone_virtual_network_link" "spoke_links" {
      + id                    = (known after apply)
      + name                  = (known after apply)
      + private_dns_zone_name = "privatelink.canadacentral.azmk8s.io"
      + registration_enabled  = false
      + resolution_policy     = (known after apply)
      + resource_group_name   = "rg-erp-cc-prod"
      + tags                  = (known after apply)
      + virtual_network_id    = (known after apply)
    }

  # module.private_dns_zones["blob"].azurerm_private_dns_zone.this will be created
  + resource "azurerm_private_dns_zone" "this" {
      + id                                                    = (known after apply)
      + max_number_of_record_sets                             = (known after apply)
      + max_number_of_virtual_network_links                   = (known after apply)
      + max_number_of_virtual_network_links_with_registration = (known after apply)
      + name                                                  = "privatelink.blob.core.windows.net"
      + number_of_record_sets                                 = (known after apply)
      + resource_group_name                                   = "rg-erp-cc-prod"
      + tags                                                  = (known after apply)

      + soa_record (known after apply)
    }

  # module.private_dns_zones["blob"].azurerm_private_dns_zone_virtual_network_link.spoke_links[0] will be created
  + resource "azurerm_private_dns_zone_virtual_network_link" "spoke_links" {
      + id                    = (known after apply)
      + name                  = (known after apply)
      + private_dns_zone_name = "privatelink.blob.core.windows.net"
      + registration_enabled  = false
      + resolution_policy     = (known after apply)
      + resource_group_name   = "rg-erp-cc-prod"
      + tags                  = (known after apply)
      + virtual_network_id    = (known after apply)
    }

  # module.private_dns_zones["file"].azurerm_private_dns_zone.this will be created
  + resource "azurerm_private_dns_zone" "this" {
      + id                                                    = (known after apply)
      + max_number_of_record_sets                             = (known after apply)
      + max_number_of_virtual_network_links                   = (known after apply)
      + max_number_of_virtual_network_links_with_registration = (known after apply)
      + name                                                  = "privatelink.file.core.windows.net"
      + number_of_record_sets                                 = (known after apply)
      + resource_group_name                                   = "rg-erp-cc-prod"
      + tags                                                  = (known after apply)

      + soa_record (known after apply)
    }

  # module.private_dns_zones["file"].azurerm_private_dns_zone_virtual_network_link.spoke_links[0] will be created
  + resource "azurerm_private_dns_zone_virtual_network_link" "spoke_links" {
      + id                    = (known after apply)
      + name                  = (known after apply)
      + private_dns_zone_name = "privatelink.file.core.windows.net"
      + registration_enabled  = false
      + resolution_policy     = (known after apply)
      + resource_group_name   = "rg-erp-cc-prod"
      + tags                  = (known after apply)
      + virtual_network_id    = (known after apply)
    }

  # module.private_dns_zones["keyvault"].azurerm_private_dns_zone.this will be created
  + resource "azurerm_private_dns_zone" "this" {
      + id                                                    = (known after apply)
      + max_number_of_record_sets                             = (known after apply)
      + max_number_of_virtual_network_links                   = (known after apply)
      + max_number_of_virtual_network_links_with_registration = (known after apply)
      + name                                                  = "privatelink.vaultcore.azure.net"
      + number_of_record_sets                                 = (known after apply)
      + resource_group_name                                   = "rg-erp-cc-prod"
      + tags                                                  = (known after apply)

      + soa_record (known after apply)
    }

  # module.private_dns_zones["keyvault"].azurerm_private_dns_zone_virtual_network_link.spoke_links[0] will be created
  + resource "azurerm_private_dns_zone_virtual_network_link" "spoke_links" {
      + id                    = (known after apply)
      + name                  = (known after apply)
      + private_dns_zone_name = "privatelink.vaultcore.azure.net"
      + registration_enabled  = false
      + resolution_policy     = (known after apply)
      + resource_group_name   = "rg-erp-cc-prod"
      + tags                  = (known after apply)
      + virtual_network_id    = (known after apply)
    }

  # module.private_dns_zones["postgres"].azurerm_private_dns_zone.this will be created
  + resource "azurerm_private_dns_zone" "this" {
      + id                                                    = (known after apply)
      + max_number_of_record_sets                             = (known after apply)
      + max_number_of_virtual_network_links                   = (known after apply)
      + max_number_of_virtual_network_links_with_registration = (known after apply)
      + name                                                  = "privatelink.postgres.database.azure.com"
      + number_of_record_sets                                 = (known after apply)
      + resource_group_name                                   = "rg-erp-cc-prod"
      + tags                                                  = (known after apply)

      + soa_record (known after apply)
    }

  # module.private_dns_zones["postgres"].azurerm_private_dns_zone_virtual_network_link.spoke_links[0] will be created
  + resource "azurerm_private_dns_zone_virtual_network_link" "spoke_links" {
      + id                    = (known after apply)
      + name                  = (known after apply)
      + private_dns_zone_name = "privatelink.postgres.database.azure.com"
      + registration_enabled  = false
      + resolution_policy     = (known after apply)
      + resource_group_name   = "rg-erp-cc-prod"
      + tags                  = (known after apply)
      + virtual_network_id    = (known after apply)
    }

  # module.spoke_vnet[0].azurerm_subnet.spoke["aks_nodes"] will be created
  + resource "azurerm_subnet" "spoke" {
      + address_prefixes                              = [
          + "10.1.0.0/20",
        ]
      + default_outbound_access_enabled               = true
      + id                                            = (known after apply)
      + name                                          = "AKSNodeSubnet"
      + private_endpoint_network_policies             = "Disabled"
      + private_link_service_network_policies_enabled = true
      + resource_group_name                           = "rg-erp-cc-prod"
      + virtual_network_name                          = "vnet-spoke-canadacentral-prod"
    }

  # module.spoke_vnet[0].azurerm_subnet.spoke["jumpbox"] will be created
  + resource "azurerm_subnet" "spoke" {
      + address_prefixes                              = [
          + "10.1.17.0/27",
        ]
      + default_outbound_access_enabled               = true
      + id                                            = (known after apply)
      + name                                          = "JumpboxSubnet"
      + private_endpoint_network_policies             = "Disabled"
      + private_link_service_network_policies_enabled = true
      + resource_group_name                           = "rg-erp-cc-prod"
      + virtual_network_name                          = "vnet-spoke-canadacentral-prod"
    }

  # module.spoke_vnet[0].azurerm_subnet.spoke["private_endpoints"] will be created
  + resource "azurerm_subnet" "spoke" {
      + address_prefixes                              = [
          + "10.1.16.0/24",
        ]
      + default_outbound_access_enabled               = true
      + id                                            = (known after apply)
      + name                                          = "PrivateEndpointsSubnet"
      + private_endpoint_network_policies             = "Disabled"
      + private_link_service_network_policies_enabled = true
      + resource_group_name                           = "rg-erp-cc-prod"
      + virtual_network_name                          = "vnet-spoke-canadacentral-prod"
    }

  # module.spoke_vnet[0].azurerm_virtual_network.spoke will be created
  + resource "azurerm_virtual_network" "spoke" {
      + address_space                  = [
          + "10.1.0.0/16",
        ]
      + dns_servers                    = (known after apply)
      + guid                           = (known after apply)
      + id                             = (known after apply)
      + location                       = "canadacentral"
      + name                           = "vnet-spoke-canadacentral-prod"
      + private_endpoint_vnet_policies = "Disabled"
      + resource_group_name            = "rg-erp-cc-prod"
      + subnet                         = (known after apply)
      + tags                           = (known after apply)
    }

  # module.storage_account.azurerm_private_endpoint.blob[0] will be created
  + resource "azurerm_private_endpoint" "blob" {
      + custom_dns_configs       = (known after apply)
      + id                       = (known after apply)
      + location                 = "canadacentral"
      + name                     = "sterpccprod-blob-pe"
      + network_interface        = (known after apply)
      + private_dns_zone_configs = (known after apply)
      + resource_group_name      = "rg-erp-cc-prod"
      + subnet_id                = (known after apply)
      + tags                     = (known after apply)

      + private_dns_zone_group {
          + id                   = (known after apply)
          + name                 = "blob-dns-zone-group"
          + private_dns_zone_ids = (known after apply)
        }

      + private_service_connection {
          + is_manual_connection           = false
          + name                           = "sterpccprod-blob-psc"
          + private_connection_resource_id = (known after apply)
          + private_ip_address             = (known after apply)
          + subresource_names              = [
              + "blob",
            ]
        }
    }

  # module.storage_account.azurerm_private_endpoint.file[0] will be created
  + resource "azurerm_private_endpoint" "file" {
      + custom_dns_configs       = (known after apply)
      + id                       = (known after apply)
      + location                 = "canadacentral"
      + name                     = "sterpccprod-file-pe"
      + network_interface        = (known after apply)
      + private_dns_zone_configs = (known after apply)
      + resource_group_name      = "rg-erp-cc-prod"
      + subnet_id                = (known after apply)
      + tags                     = (known after apply)

      + private_dns_zone_group {
          + id                   = (known after apply)
          + name                 = "file-dns-zone-group"
          + private_dns_zone_ids = (known after apply)
        }

      + private_service_connection {
          + is_manual_connection           = false
          + name                           = "sterpccprod-file-psc"
          + private_connection_resource_id = (known after apply)
          + private_ip_address             = (known after apply)
          + subresource_names              = [
              + "file",
            ]
        }
    }

  # module.storage_account.azurerm_storage_account.this will be created
  + resource "azurerm_storage_account" "this" {
      + access_tier                        = (known after apply)
      + account_kind                       = "StorageV2"
      + account_replication_type           = "ZRS"
      + account_tier                       = "Standard"
      + allow_nested_items_to_be_public    = false
      + cross_tenant_replication_enabled   = false
      + default_to_oauth_authentication    = false
      + dns_endpoint_type                  = "Standard"
      + https_traffic_only_enabled         = true
      + id                                 = (known after apply)
      + infrastructure_encryption_enabled  = false
      + is_hns_enabled                     = false
      + large_file_share_enabled           = (known after apply)
      + local_user_enabled                 = true
      + location                           = "canadacentral"
      + min_tls_version                    = "TLS1_2"
      + name                               = "sterpccprod"
      + nfsv3_enabled                      = false
      + primary_access_key                 = (sensitive value)
      + primary_blob_connection_string     = (sensitive value)
      + primary_blob_endpoint              = (known after apply)
      + primary_blob_host                  = (known after apply)
      + primary_blob_internet_endpoint     = (known after apply)
      + primary_blob_internet_host         = (known after apply)
      + primary_blob_microsoft_endpoint    = (known after apply)
      + primary_blob_microsoft_host        = (known after apply)
      + primary_connection_string          = (sensitive value)
      + primary_dfs_endpoint               = (known after apply)
      + primary_dfs_host                   = (known after apply)
      + primary_dfs_internet_endpoint      = (known after apply)
      + primary_dfs_internet_host          = (known after apply)
      + primary_dfs_microsoft_endpoint     = (known after apply)
      + primary_dfs_microsoft_host         = (known after apply)
      + primary_file_endpoint              = (known after apply)
      + primary_file_host                  = (known after apply)
      + primary_file_internet_endpoint     = (known after apply)
      + primary_file_internet_host         = (known after apply)
      + primary_file_microsoft_endpoint    = (known after apply)
      + primary_file_microsoft_host        = (known after apply)
      + primary_location                   = (known after apply)
      + primary_queue_endpoint             = (known after apply)
      + primary_queue_host                 = (known after apply)
      + primary_queue_microsoft_endpoint   = (known after apply)
      + primary_queue_microsoft_host       = (known after apply)
      + primary_table_endpoint             = (known after apply)
      + primary_table_host                 = (known after apply)
      + primary_table_microsoft_endpoint   = (known after apply)
      + primary_table_microsoft_host       = (known after apply)
      + primary_web_endpoint               = (known after apply)
      + primary_web_host                   = (known after apply)
      + primary_web_internet_endpoint      = (known after apply)
      + primary_web_internet_host          = (known after apply)
      + primary_web_microsoft_endpoint     = (known after apply)
      + primary_web_microsoft_host         = (known after apply)
      + public_network_access_enabled      = false
      + queue_encryption_key_type          = "Service"
      + resource_group_name                = "rg-erp-cc-prod"
      + secondary_access_key               = (sensitive value)
      + secondary_blob_connection_string   = (sensitive value)
      + secondary_blob_endpoint            = (known after apply)
      + secondary_blob_host                = (known after apply)
      + secondary_blob_internet_endpoint   = (known after apply)
      + secondary_blob_internet_host       = (known after apply)
      + secondary_blob_microsoft_endpoint  = (known after apply)
      + secondary_blob_microsoft_host      = (known after apply)
      + secondary_connection_string        = (sensitive value)
      + secondary_dfs_endpoint             = (known after apply)
      + secondary_dfs_host                 = (known after apply)
      + secondary_dfs_internet_endpoint    = (known after apply)
      + secondary_dfs_internet_host        = (known after apply)
      + secondary_dfs_microsoft_endpoint   = (known after apply)
      + secondary_dfs_microsoft_host       = (known after apply)
      + secondary_file_endpoint            = (known after apply)
      + secondary_file_host                = (known after apply)
      + secondary_file_internet_endpoint   = (known after apply)
      + secondary_file_internet_host       = (known after apply)
      + secondary_file_microsoft_endpoint  = (known after apply)
      + secondary_file_microsoft_host      = (known after apply)
      + secondary_location                 = (known after apply)
      + secondary_queue_endpoint           = (known after apply)
      + secondary_queue_host               = (known after apply)
      + secondary_queue_microsoft_endpoint = (known after apply)
      + secondary_queue_microsoft_host     = (known after apply)
      + secondary_table_endpoint           = (known after apply)
      + secondary_table_host               = (known after apply)
      + secondary_table_microsoft_endpoint = (known after apply)
      + secondary_table_microsoft_host     = (known after apply)
      + secondary_web_endpoint             = (known after apply)
      + secondary_web_host                 = (known after apply)
      + secondary_web_internet_endpoint    = (known after apply)
      + secondary_web_internet_host        = (known after apply)
      + secondary_web_microsoft_endpoint   = (known after apply)
      + secondary_web_microsoft_host       = (known after apply)
      + sftp_enabled                       = false
      + shared_access_key_enabled          = true
      + table_encryption_key_type          = "Service"
      + tags                               = (known after apply)

      + blob_properties {
          + change_feed_enabled      = false
          + default_service_version  = (known after apply)
          + last_access_time_enabled = false
          + versioning_enabled       = true

          + container_delete_retention_policy {
              + days = 7
            }

          + delete_retention_policy {
              + days                     = 7
              + permanent_delete_enabled = false
            }
        }

      + network_rules {
          + bypass                     = [
              + "AzureServices",
            ]
          + default_action             = "Deny"
          + ip_rules                   = (known after apply)
          + virtual_network_subnet_ids = (known after apply)
        }

      + queue_properties (known after apply)

      + routing (known after apply)

      + share_properties (known after apply)

      + static_website (known after apply)
    }

  # module.vnet_peering["default"].azurerm_virtual_network_peering.hub_to_spoke will be created
  + resource "azurerm_virtual_network_peering" "hub_to_spoke" {
      + allow_forwarded_traffic                = true
      + allow_gateway_transit                  = false
      + allow_virtual_network_access           = true
      + id                                     = (known after apply)
      + name                                   = "peer-vnet-hub-canadacentral-prod-to-vnet-spoke-canadacentral-prod"
      + peer_complete_virtual_networks_enabled = true
      + remote_virtual_network_id              = (known after apply)
      + resource_group_name                    = "rg-erp-cc-prod"
      + use_remote_gateways                    = false
      + virtual_network_name                   = "vnet-hub-canadacentral-prod"
    }

  # module.vnet_peering["default"].azurerm_virtual_network_peering.spoke_to_hub will be created
  + resource "azurerm_virtual_network_peering" "spoke_to_hub" {
      + allow_forwarded_traffic                = true
      + allow_gateway_transit                  = false
      + allow_virtual_network_access           = true
      + id                                     = (known after apply)
      + name                                   = "peer-vnet-spoke-canadacentral-prod-to-vnet-hub-canadacentral-prod"
      + peer_complete_virtual_networks_enabled = true
      + remote_virtual_network_id              = (known after apply)
      + resource_group_name                    = "rg-erp-cc-prod"
      + use_remote_gateways                    = false
      + virtual_network_name                   = "vnet-spoke-canadacentral-prod"
    }

Plan: 69 to add, 0 to change, 0 to destroy.

Changes to Outputs:
  + aks_cluster_fqdn              = (known after apply)
  + aks_cluster_name              = "aks-canadacentral-prod"
  + deployment_stage              = "stage1"
  + firewall_private_ip           = (known after apply)
  + firewall_public_ip            = (known after apply)
  + get_aks_credentials_command   = "az aks get-credentials --resource-group rg-erp-cc-prod --name aks-canadacentral-prod"
  + hub_vnet_id                   = (known after apply)
  + istio_lb_ip_discovery_command = "kubectl get svc istio-ingressgateway -n istio-system -o jsonpath='{.status.loadBalancer.ingress[0].ip}'"
  + outbound_type                 = "loadBalancer"
  + resource_group_name           = "rg-erp-cc-prod"
  + spoke_vnet_id                 = (known after apply)
